apiVersion: v1
kind: ConfigMap
metadata:
  name: kubeshark-config-map
  annotations:
    "helm.sh/hook": post-install
    "helm.sh/hook-delete-policy": before-hook-creation
data:
  SCRIPTING_SCRIPTS: |
    {
      "0": {
        "title": "send_data_to_k-td",
        "code": "function onItemCaptured(data) {\n    if (data.Protocol && (data.Protocol.Name == \"http\" || data.Protocol.Name == \"dns\")) {\n        responseL7 = vendor.webhook(\n        \"POST\",\n        env.KTD_ENDPOINT+\"/save-l7-record\",\n        JSON.stringify({\n            Protocol: data.Protocol.Name,\n            Request: data.Request,\n            Source: data.Source.IP,\n            Length: data.Size,\n            ClientID: env.ACCESS_KEY+\"-\"+env.CLUSTER_ID,\n        }),\n        {\n            \"content-type\": \"application/json\"\n        }\n        );\n    }\n\n    if (data.Protocol && (data.Protocol.Name == \"tcp\" || data.Protocol.Name == \"udp\" || data.Protocol.Name == \"icmp\" \n        || data.Protocol.Name == \"http\" || data.Protocol.Name == \"dns\")) {\n        responseDDOS = vendor.webhook(\n            \"POST\",\n            env.KTD_ENDPOINT+\"/save-ddos-record\",\n            JSON.stringify({\n                Source: data.Source.IP,\n                Target: data.Destination.IP,\n                Protocol: data.Protocol.Name,\n                Date: data.Timesamp,\n                Request: (data.Protocol.Name == \"http\" || data.Protocol.Name == \"dns\") ? data.Request : data.Data,\n                Length: data.Size,\n                ClientID: env.ACCESS_KEY+\"-\"+env.CLUSTER_ID,\n            }),\n            {\n                \"content-type\": \"application/json\"\n            }\n        );\n    }\n    \n    responseIp = vendor.webhook(\n        \"POST\",\n        env.KTD_ENDPOINT+\"/save-ip-record\",\n        JSON.stringify({\n            Source: data.Source.IP,\n            ClientID: env.ACCESS_KEY+\"-\"+env.CLUSTER_ID,\n        }),\n        {\n            \"content-type\": \"application/json\"\n        }\n    );\n}",
        "active": true,
        "internal": false
      }
    }